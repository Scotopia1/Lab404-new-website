# PLAN: Order Confirmation Emails

**Phase:** 4 - Email Notification System
**Plan:** 1 of 1
**Complexity:** Medium
**Estimated Scope:** 6-7 tasks

---

## Objective

Implement order confirmation emails sent to customers immediately after successful order placement, and new order notification emails sent to admin. Integrate with existing MailerService and order creation flow.

**Why This Matters:**
- Customers need immediate confirmation of their order with details
- Admins need to be notified of new orders for fulfillment
- Professional email communication builds trust and brand
- Email serves as receipt and reference for COD payment

**Scope:** Email templates + email service integration with order creation

---

## Execution Context

**Related Files:**
- `apps/api/src/services/mailer.service.ts` - Existing SMTP service (Nodemailer configured)
- `apps/api/src/routes/orders.routes.ts` - Order creation endpoint (line 239-245 sends response)
- `packages/database/src/schema/orders.ts` - Order schema with all fields
- `packages/shared-types/src/settings.ts` - Settings with `orderNotificationEmail`

**Current State:**
✅ MailerService exists with Nodemailer configured
✅ SMTP configuration in `.env.example` (SMTP_HOST, SMTP_USER, SMTP_PASS)
✅ Order creation endpoint creates orders successfully
✅ Settings have `orderNotificationEmail` field
✅ Order schema has all needed data (orderNumber, shippingAddress, items, totals)
❌ No email templates exist
❌ No email sending on order creation
❌ No email template service/helper

**SMTP Configuration:**
```env
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your_email@gmail.com
SMTP_PASS=your_app_password
SMTP_FROM_EMAIL=your_email@gmail.com
SMTP_FROM_NAME=Lab404 Electronics
```

---

## Context

### Phase Dependencies
- **Phase 3 Complete:** Checkout creates orders with correct data structure
- **Blocks Phase 5:** Customer account needs order history (emails provide order numbers)

### Discovery Findings

**MailerService (mailer.service.ts:66-98):**
```typescript
async sendEmail(options: EmailOptions): Promise<boolean> {
  // Handles: to, subject, html, text, attachments
  // Returns: boolean (success/failure)
  // Logs: errors and success messages
}
```

**Order Creation (orders.routes.ts:239-245):**
```typescript
sendCreated(res, {
  orderId: order.id,
  orderNumber: order.orderNumber,
  total: totals.total,
  status: order.status,
  paymentMethod: order.paymentMethod,
});
```
After this response, we need to send emails asynchronously.

**Available Order Data:**
- Order: orderNumber, status, paymentMethod, customerNotes
- Shipping: shippingAddress (firstName, lastName, addressLine1, city, country, phone, email)
- Pricing: subtotal, taxRate, taxAmount, shippingAmount, discountAmount, total, currency
- Items: productNameSnapshot, skuSnapshot, quantity, unitPriceSnapshot
- Promo: promoCodeSnapshot (if used)
- Timestamps: createdAt

**Settings Available:**
- `orderNotificationEmail` - Admin email for new order notifications
- `storeEmail` - Store contact email
- `storeName` - Store name for branding

---

## Tasks

### Task 1: Create Email Template Service
**Goal:** Create reusable email template builder with HTML generation

**Create `apps/api/src/services/email-templates.service.ts`:**
```typescript
interface OrderEmailData {
  orderNumber: string;
  customerName: string;
  customerEmail: string;
  shippingAddress: AddressJson;
  items: Array<{
    productName: string;
    sku: string;
    quantity: number;
    unitPrice: number;
    lineTotal: number;
  }>;
  subtotal: number;
  taxRate: number;
  taxAmount: number;
  shippingAmount: number;
  discountAmount: number;
  total: number;
  currency: string;
  promoCode?: string;
  customerNotes?: string;
  orderDate: string;
  paymentMethod: string;
}

class EmailTemplatesService {
  /**
   * Generate customer order confirmation email HTML
   */
  generateOrderConfirmationEmail(data: OrderEmailData): string {
    // Returns complete HTML email
    // Uses inline CSS for email client compatibility
    // Includes: Lab404 branding, order details, item list, pricing breakdown
    // COD payment instructions
  }

  /**
   * Generate admin new order notification email HTML
   */
  generateNewOrderNotificationEmail(data: OrderEmailData): string {
    // Returns complete HTML email
    // Simpler format for admin: order number, customer info, items, total
    // Link to admin dashboard to view order
  }

  /**
   * Generate email layout wrapper
   */
  private generateEmailLayout(content: string, title: string): string {
    // Returns HTML email structure with:
    // - DOCTYPE and meta tags for email clients
    // - Responsive viewport settings
    // - Inline CSS reset
    // - Header with Lab404 logo/branding
    // - Content area
    // - Footer with contact info and social links
  }

  /**
   * Format currency for display
   */
  private formatCurrency(amount: number, currency: string): string {
    return `$${amount.toFixed(2)}`;
  }

  /**
   * Format address for display
   */
  private formatAddress(address: AddressJson): string {
    // Returns formatted multi-line address string
  }
}

export const emailTemplatesService = new EmailTemplatesService();
```

**Email Design Guidelines:**
- Use inline CSS (email clients don't support `<style>` tags well)
- Use tables for layout (flexbox/grid not supported in many email clients)
- Max width 600px for email body
- Use web-safe fonts (Arial, Helvetica, sans-serif)
- Use absolute URLs for images/logos (if any)
- Test with plain text fallback

**Validation:**
- TypeScript compiles without errors
- Service exports singleton instance
- Methods return valid HTML strings

**Files:**
- `apps/api/src/services/email-templates.service.ts` (NEW FILE)

---

### Task 2: Create Order Confirmation Email Template
**Goal:** Design professional HTML email for customer order confirmation

**Template Structure:**
```html
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Order Confirmation - #{orderNumber}</title>
</head>
<body style="margin:0; padding:0; font-family:Arial,sans-serif; background-color:#f4f4f4;">
  <table width="100%" cellpadding="0" cellspacing="0" style="background-color:#f4f4f4;">
    <tr>
      <td align="center" style="padding:20px 0;">
        <table width="600" cellpadding="0" cellspacing="0" style="background-color:#ffffff; border-radius:8px;">

          <!-- Header -->
          <tr>
            <td style="background-color:#2563eb; color:#ffffff; padding:30px 40px; text-align:center;">
              <h1 style="margin:0; font-size:28px;">Lab404 Electronics</h1>
            </td>
          </tr>

          <!-- Order Confirmation Message -->
          <tr>
            <td style="padding:40px 40px 20px;">
              <h2 style="margin:0 0 10px; color:#1f2937;">Order Confirmed!</h2>
              <p style="margin:0; color:#6b7280; font-size:16px;">
                Thank you for your order. We'll prepare it and contact you for delivery.
              </p>
            </td>
          </tr>

          <!-- Order Number -->
          <tr>
            <td style="padding:0 40px 30px;">
              <div style="background-color:#f3f4f6; padding:20px; border-radius:6px; text-align:center;">
                <p style="margin:0 0 5px; font-size:14px; color:#6b7280;">Order Number</p>
                <p style="margin:0; font-size:24px; font-weight:bold; color:#1f2937;">#{orderNumber}</p>
              </div>
            </td>
          </tr>

          <!-- Order Items -->
          <tr>
            <td style="padding:0 40px 30px;">
              <h3 style="margin:0 0 15px; color:#1f2937;">Order Details</h3>
              <table width="100%" cellpadding="8" cellspacing="0" style="border:1px solid #e5e7eb; border-radius:6px;">
                <thead>
                  <tr style="background-color:#f9fafb;">
                    <th style="text-align:left; font-size:14px; color:#6b7280;">Item</th>
                    <th style="text-align:center; font-size:14px; color:#6b7280;">Qty</th>
                    <th style="text-align:right; font-size:14px; color:#6b7280;">Price</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Loop items here -->
                  <tr>
                    <td style="font-size:14px; color:#1f2937;">{productName}</td>
                    <td style="text-align:center; font-size:14px; color:#1f2937;">{quantity}</td>
                    <td style="text-align:right; font-size:14px; color:#1f2937;">${lineTotal}</td>
                  </tr>
                </tbody>
              </table>
            </td>
          </tr>

          <!-- Price Breakdown -->
          <tr>
            <td style="padding:0 40px 30px;">
              <table width="100%" cellpadding="8" cellspacing="0">
                <tr>
                  <td style="font-size:14px; color:#6b7280;">Subtotal</td>
                  <td style="text-align:right; font-size:14px; color:#1f2937;">${subtotal}</td>
                </tr>
                <tr>
                  <td style="font-size:14px; color:#6b7280;">Tax</td>
                  <td style="text-align:right; font-size:14px; color:#1f2937;">${taxAmount}</td>
                </tr>
                <tr>
                  <td style="font-size:14px; color:#6b7280;">Shipping</td>
                  <td style="text-align:right; font-size:14px; color:#1f2937;">Free</td>
                </tr>
                <tr style="border-top:2px solid #e5e7eb;">
                  <td style="font-size:18px; font-weight:bold; color:#1f2937; padding-top:12px;">Total</td>
                  <td style="text-align:right; font-size:18px; font-weight:bold; color:#1f2937; padding-top:12px;">${total}</td>
                </tr>
              </table>
            </td>
          </tr>

          <!-- COD Payment Notice -->
          <tr>
            <td style="padding:0 40px 30px;">
              <div style="background-color:#fef3c7; border-left:4px solid #f59e0b; padding:15px;">
                <p style="margin:0; font-size:14px; color:#92400e;">
                  <strong>Payment Method:</strong> Cash on Delivery (COD)<br>
                  Pay with cash when you receive your order.
                </p>
              </div>
            </td>
          </tr>

          <!-- Shipping Address -->
          <tr>
            <td style="padding:0 40px 30px;">
              <h3 style="margin:0 0 10px; color:#1f2937;">Shipping Address</h3>
              <p style="margin:0; font-size:14px; color:#6b7280; line-height:1.6;">
                {customerName}<br>
                {addressLine1}<br>
                {city}, {country}<br>
                {phone}
              </p>
            </td>
          </tr>

          <!-- Footer -->
          <tr>
            <td style="background-color:#f9fafb; padding:30px 40px; text-align:center; border-top:1px solid #e5e7eb;">
              <p style="margin:0 0 10px; font-size:14px; color:#6b7280;">
                Questions? Contact us at <a href="mailto:{storeEmail}" style="color:#2563eb;">{storeEmail}</a>
              </p>
              <p style="margin:0; font-size:12px; color:#9ca3af;">
                © 2026 Lab404 Electronics. All rights reserved.
              </p>
            </td>
          </tr>

        </table>
      </td>
    </tr>
  </table>
</body>
</html>
```

**Features:**
- Responsive (mobile-friendly)
- Professional design with Lab404 branding
- Clear order number prominently displayed
- Complete item list with quantities and prices
- Price breakdown with tax (from Phase 2)
- COD payment instructions
- Shipping address for reference
- Contact information in footer

**Validation:**
- Email renders correctly in Gmail, Outlook, Apple Mail
- All data fields populated correctly
- Currency formatting consistent
- Mobile responsive (scales to phone width)

**Files:**
- Implementation in `email-templates.service.ts` `generateOrderConfirmationEmail()` method

---

### Task 3: Create Admin New Order Notification Template
**Goal:** Simple notification email for admin when new orders placed

**Template Structure (Simpler than customer email):**
```html
<!DOCTYPE html>
<html>
<body style="font-family:Arial,sans-serif; background-color:#f4f4f4; padding:20px;">
  <div style="max-width:600px; margin:0 auto; background-color:#ffffff; padding:30px; border-radius:8px;">

    <h2 style="margin:0 0 20px; color:#1f2937;">New Order Received</h2>

    <div style="background-color:#dbeafe; padding:15px; border-radius:6px; margin-bottom:20px;">
      <p style="margin:0; font-size:14px; color:#1e40af;">
        <strong>Order Number:</strong> #{orderNumber}
      </p>
    </div>

    <h3 style="margin:0 0 10px; color:#1f2937;">Customer</h3>
    <p style="margin:0 0 20px; color:#6b7280;">
      {customerName}<br>
      {customerEmail}<br>
      {phone}
    </p>

    <h3 style="margin:0 0 10px; color:#1f2937;">Order Summary</h3>
    <table width="100%" cellpadding="8" cellspacing="0" style="border:1px solid #e5e7eb; margin-bottom:20px;">
      <tr style="background-color:#f9fafb;">
        <th style="text-align:left;">Item</th>
        <th style="text-align:center;">Qty</th>
        <th style="text-align:right;">Price</th>
      </tr>
      <!-- Loop items -->
      <tr>
        <td>{productName}</td>
        <td style="text-align:center;">{quantity}</td>
        <td style="text-align:right;">${lineTotal}</td>
      </tr>
    </table>

    <div style="text-align:right; font-size:18px; font-weight:bold; color:#1f2937; margin-bottom:20px;">
      Total: ${total}
    </div>

    <div style="background-color:#fef3c7; padding:15px; border-radius:6px; margin-bottom:20px;">
      <p style="margin:0; color:#92400e;">
        <strong>Payment:</strong> Cash on Delivery (COD)
      </p>
    </div>

    <h3 style="margin:0 0 10px; color:#1f2937;">Shipping Address</h3>
    <p style="margin:0 0 20px; color:#6b7280;">
      {fullAddress}
    </p>

    <div style="text-align:center; margin-top:30px;">
      <a href="https://admin.lab404electronics.com/orders/{orderId}"
         style="display:inline-block; background-color:#2563eb; color:#ffffff; padding:12px 24px; text-decoration:none; border-radius:6px;">
        View Order in Dashboard
      </a>
    </div>

  </div>
</body>
</html>
```

**Features:**
- Clean, functional design for internal use
- Order number prominently displayed
- Customer contact info for fulfillment
- Order summary with items and total
- COD payment indicator
- Shipping address
- Link to admin dashboard (if admin is deployed)

**Validation:**
- Email renders correctly
- All order data included
- Admin dashboard link works (or displays order ID if not deployed)

**Files:**
- Implementation in `email-templates.service.ts` `generateNewOrderNotificationEmail()` method

---

### Task 4: Integrate Email Sending into Order Creation
**Goal:** Send emails asynchronously after successful order creation

**Changes to `orders.routes.ts` POST /api/orders endpoint:**
```typescript
// After line 245 (after sendCreated response)
// Send emails asynchronously (don't await - fire and forget)
// This prevents email failures from blocking order creation

// 1. Fetch full order with items for email
const orderWithItems = await db.query.orders.findFirst({
  where: eq(orders.id, order.id),
  with: {
    items: true,
  },
});

// 2. Get settings for admin email
const [storeSettings] = await db
  .select()
  .from(settings)
  .where(eq(settings.key, 'store'));

const storeConfig = storeSettings?.value as {
  orderNotificationEmail?: string;
  storeEmail?: string;
  storeName?: string;
} || {};

// 3. Prepare email data
const emailData: OrderEmailData = {
  orderNumber: order.orderNumber,
  customerName: `${order.shippingAddress.firstName} ${order.shippingAddress.lastName}`,
  customerEmail: order.shippingAddress.email, // Or from customer table
  shippingAddress: order.shippingAddress,
  items: orderWithItems.items.map(item => ({
    productName: item.productNameSnapshot,
    sku: item.skuSnapshot,
    quantity: item.quantity,
    unitPrice: Number(item.unitPriceSnapshot),
    lineTotal: Number(item.unitPriceSnapshot) * item.quantity,
  })),
  subtotal: Number(order.subtotalSnapshot),
  taxRate: Number(order.taxRateSnapshot),
  taxAmount: Number(order.taxAmountSnapshot),
  shippingAmount: Number(order.shippingAmountSnapshot),
  discountAmount: Number(order.discountAmountSnapshot),
  total: Number(order.totalSnapshot),
  currency: order.currency,
  promoCode: order.promoCodeSnapshot || undefined,
  customerNotes: order.customerNotes || undefined,
  orderDate: order.createdAt.toISOString(),
  paymentMethod: order.paymentMethod,
};

// 4. Send customer confirmation email (async, don't block response)
const customerEmailHtml = emailTemplatesService.generateOrderConfirmationEmail(emailData);
mailerService.sendEmail({
  to: emailData.customerEmail,
  subject: `Order Confirmation - ${order.orderNumber}`,
  html: customerEmailHtml,
}).catch(error => {
  logger.error('Failed to send customer order confirmation email', {
    error,
    orderId: order.id,
    orderNumber: order.orderNumber
  });
});

// 5. Send admin notification email (async, don't block response)
if (storeConfig.orderNotificationEmail) {
  const adminEmailHtml = emailTemplatesService.generateNewOrderNotificationEmail(emailData);
  mailerService.sendEmail({
    to: storeConfig.orderNotificationEmail,
    subject: `New Order: ${order.orderNumber}`,
    html: adminEmailHtml,
  }).catch(error => {
    logger.error('Failed to send admin order notification email', {
      error,
      orderId: order.id,
      orderNumber: order.orderNumber
    });
  });
}
```

**Important Notes:**
- Send emails AFTER the response (don't await)
- Use `.catch()` for error handling (don't throw)
- Log failures but don't fail the order creation
- Emails sent asynchronously won't block the API response
- If SMTP not configured, mailerService logs warning and returns false

**Validation:**
- Order creation still succeeds even if emails fail
- Customer receives confirmation email within seconds
- Admin receives notification email (if orderNotificationEmail set)
- Email failures logged properly
- No performance impact on order creation response time

**Files:**
- `apps/api/src/routes/orders.routes.ts` - Add email sending after order creation

---

### Task 5: Add Email Configuration to Settings
**Goal:** Allow admin to configure order notification email address

**Changes to `apps/api/src/routes/settings.routes.ts`:**

The settings already support `orderNotificationEmail` in the schema (from shared-types).
No backend changes needed - just ensure it's returned in the settings API.

**Verify Settings API Returns:**
```typescript
{
  store: {
    storeName: "Lab404 Electronics",
    storeEmail: "contact@lab404electronics.com",
    orderNotificationEmail: "orders@lab404electronics.com", // ✅ This field
    // ... other settings
  }
}
```

**Admin Dashboard (Optional for this plan):**
- Settings UI in admin dashboard already exists
- Add `orderNotificationEmail` field to settings form
- Out of scope for this plan (can be done in future)

**For Now:**
- Admin can set via API: `PUT /api/settings`
- Or manually in database settings table
- Document in `.env.example` as setup step

**Documentation in `.env.example`:**
```env
# ===========================================
# Email Notifications
# ===========================================
# After configuring SMTP above, set orderNotificationEmail via:
# POST /api/settings
# {
#   "store": {
#     "orderNotificationEmail": "admin@lab404electronics.com"
#   }
# }
```

**Validation:**
- Settings API returns orderNotificationEmail if set
- Admin emails only sent if orderNotificationEmail configured
- Customer emails always sent (to their provided email)

**Files:**
- `.env.example` - Add documentation for email configuration

---

### Task 6: Add Email Error Handling and Logging
**Goal:** Comprehensive error handling for email failures

**Already Handled:**
- MailerService returns `boolean` (true/false)
- MailerService logs errors internally
- Order creation catches email failures with `.catch()`
- Errors logged but don't fail order creation

**Additional Logging in orders.routes.ts:**
```typescript
// After sending customer email
mailerService.sendEmail({ ... }).then(success => {
  if (success) {
    logger.info('Order confirmation email sent', {
      orderId: order.id,
      orderNumber: order.orderNumber,
      customerEmail: emailData.customerEmail
    });
  }
}).catch(error => {
  logger.error('Failed to send order confirmation email', {
    error,
    orderId: order.id,
    orderNumber: order.orderNumber,
    customerEmail: emailData.customerEmail
  });
});

// After sending admin email
mailerService.sendEmail({ ... }).then(success => {
  if (success) {
    logger.info('Admin order notification sent', {
      orderId: order.id,
      orderNumber: order.orderNumber,
      adminEmail: storeConfig.orderNotificationEmail
    });
  }
}).catch(error => {
  logger.error('Failed to send admin order notification', {
    error,
    orderId: order.id,
    orderNumber: order.orderNumber,
    adminEmail: storeConfig.orderNotificationEmail
  });
});
```

**Graceful Degradation:**
- If SMTP not configured: mailerService logs warning, returns false, no error thrown
- If email invalid: Nodemailer throws, caught by `.catch()`, logged
- If SMTP server down: Nodemailer throws, caught by `.catch()`, logged
- Order creation always succeeds regardless of email status

**Validation:**
- Email failures don't break order creation
- All email attempts logged (success and failure)
- Logs include order ID and order number for debugging
- Admin can check logs if customer reports no email

**Files:**
- `apps/api/src/routes/orders.routes.ts` - Enhanced logging for email sending

---

### Task 7: Test Email Templates and Delivery
**Goal:** Manual testing of email rendering and delivery

**Test Scenarios:**

**1. Customer Order Confirmation Email:**
- Create test order via checkout
- Verify email received at customer email
- Check email rendering in:
  - Gmail web
  - Gmail mobile app
  - Outlook (if available)
  - Apple Mail (if available)
- Verify all data correct:
  - Order number
  - Customer name
  - Items with correct quantities and prices
  - Subtotal, tax, shipping, total
  - COD payment notice
  - Shipping address
  - Footer with contact email

**2. Admin New Order Notification:**
- Configure orderNotificationEmail in settings
- Create test order
- Verify admin email received
- Check all order details present
- Verify dashboard link (if applicable)

**3. Email Failure Scenarios:**
- Invalid customer email: Check logs show error, order still created
- SMTP not configured: Check logs show warning, order still created
- SMTP server unreachable: Check logs show error, order still created

**4. Plain Text Fallback:**
- Check that mailerService generates plain text from HTML
- Verify plain text readable

**Testing Checklist:**
- [ ] Customer confirmation email delivers successfully
- [ ] Customer email renders correctly on mobile
- [ ] Customer email renders correctly on desktop
- [ ] All customer order data accurate in email
- [ ] Admin notification email delivers successfully
- [ ] Admin email contains all necessary order info
- [ ] Emails sent asynchronously (no delay in order creation)
- [ ] Email failures logged properly
- [ ] Email failures don't break order creation
- [ ] Plain text fallback generated correctly

**Files:**
- No files modified (testing only)

---

## Verification Checklist

**Before marking complete:**
- [ ] EmailTemplatesService created with order confirmation template method
- [ ] EmailTemplatesService created with admin notification template method
- [ ] Customer order confirmation email template designed and implemented
- [ ] Admin new order notification template designed and implemented
- [ ] Email sending integrated into order creation endpoint
- [ ] Emails sent asynchronously (don't block response)
- [ ] Email failures handled gracefully
- [ ] Settings API returns orderNotificationEmail field
- [ ] Comprehensive logging for email success/failure
- [ ] Customer emails always sent (to their provided email)
- [ ] Admin emails only sent if orderNotificationEmail configured
- [ ] Email templates render correctly in major email clients
- [ ] All order data appears correctly in emails
- [ ] COD payment instructions clear in emails
- [ ] Contact information in email footer

---

## Success Criteria

**Must Have:**
1. ✅ Customer receives order confirmation email immediately after checkout
2. ✅ Admin receives new order notification (if configured)
3. ✅ Emails contain all order details (items, prices, address)
4. ✅ COD payment instructions in customer email
5. ✅ Email failures don't break order creation
6. ✅ Emails sent asynchronously (no performance impact)

**Email Quality:**
- Professional design with Lab404 branding
- Mobile-responsive templates
- Clear order information
- Correct data formatting (currency, dates, addresses)
- Working links and contact information

**Technical Quality:**
- Reusable email template service
- Clean separation of concerns (templates vs delivery)
- Comprehensive error handling
- Detailed logging for debugging
- No performance regression on order creation

---

## Output

**New Files:**
- `apps/api/src/services/email-templates.service.ts` - Email template generation service

**Modified Files:**
- `apps/api/src/routes/orders.routes.ts` - Email sending after order creation
- `.env.example` - Email notification configuration documentation

**Testing:**
- Manual email delivery testing
- Email rendering testing across clients
- Error scenario testing

**Documentation:**
- Code comments explaining email flow
- `.env.example` updated with email setup instructions

**Commits:**
- Commit 1: Create email templates service
- Commit 2: Create customer order confirmation template
- Commit 3: Create admin order notification template
- Commit 4: Integrate email sending into order creation
- Commit 5: Add email configuration documentation
- Commit 6: Enhance email error handling and logging
- Commit 7: Test email delivery and rendering
- Commit 8: Create SUMMARY.md

---

## Risk Assessment

**Medium Risk:**
- Email rendering inconsistencies across clients (mitigation: use tables and inline CSS)
- SMTP configuration issues (mitigation: clear documentation, graceful fallback)

**Low Risk:**
- Email delivery failures (already handled gracefully)
- Template design (straightforward HTML)

**Mitigation:**
- Emails sent asynchronously - failures don't affect order creation
- Comprehensive logging helps debug email issues
- Graceful degradation if SMTP not configured
- Clear setup documentation in `.env.example`

---

## Notes

**Why 7 Tasks:**
- Task 1: Create email templates service (infrastructure)
- Task 2: Customer confirmation email template (main feature)
- Task 3: Admin notification email template (admin feature)
- Task 4: Integrate email sending into order creation (main integration)
- Task 5: Email configuration in settings (configuration)
- Task 6: Error handling and logging (reliability)
- Task 7: Testing (validation)

**Out of Scope (Future):**
- Order status update emails (processing, shipped, delivered)
- Admin dashboard UI for email settings
- Email preview/test functionality in admin
- Advanced email templates with images/logos
- Email template customization by admin

**Email Client Compatibility:**
- Gmail (web + mobile) - Primary target
- Outlook - Secondary target
- Apple Mail - Nice to have
- Will use email-safe HTML (tables, inline CSS)

**SMTP Providers:**
- Gmail (recommended for testing/small scale)
- SendGrid (recommended for production)
- AWS SES (alternative for production)
- Any SMTP-compatible service

**Dependencies:**
✅ Phase 3: Order creation with correct data
→ Phase 5: Customer account will link to emails

---

*Plan created: 2026-01-08*
*Ready for execution: Yes*
*Estimated time: 3-4 hours*
