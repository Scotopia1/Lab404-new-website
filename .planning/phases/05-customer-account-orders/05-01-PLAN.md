# PLAN: Customer Order History

**Phase:** 5 - Customer Account - Order History
**Plan:** 1 of 1
**Complexity:** Medium
**Estimated Scope:** 5-6 tasks

---

## Objective

Connect order history pages to live API data, implement React Query hooks for order fetching, display real order status with proper badges, and show complete order details with items and pricing breakdown.

**Why This Matters:**
- Customers need to track their orders after checkout
- Order history builds trust and transparency
- Real-time status updates keep customers informed
- Order details serve as digital receipts

**Scope:** Frontend implementation connecting to existing API endpoints

---

## Execution Context

**Related Files:**
- `apps/lab404-website/src/app/account/orders/page.tsx` - Order list page (USES MOCK DATA)
- `apps/lab404-website/src/app/account/orders/[id]/page.tsx` - Order detail page (USES MOCK DATA)
- `apps/api/src/routes/orders.routes.ts` - Orders API endpoints (ALREADY IMPLEMENTED)
- `packages/database/src/schema/orders.ts` - Order schema with status enums

**Current State:**
✅ API endpoints exist:
  - `GET /api/orders` - List customer orders with pagination (line 431)
  - `GET /api/orders/:id` - Get single order with items (line 478)
✅ Order schema complete with all fields
✅ Account pages exist with good UI structure
✅ Account layout exists
❌ Pages use hardcoded mock data
❌ No React Query hooks for orders
❌ Order status badges not dynamic
❌ No loading/error states

**Order Status Values:**
```typescript
orderStatus: 'pending' | 'confirmed' | 'processing' | 'shipped' | 'delivered' | 'cancelled'
paymentStatus: 'pending' | 'paid' | 'refunded' | 'failed'
```

**API Response Structure:**
```typescript
// GET /api/orders
{
  data: [
    {
      id: string,
      orderNumber: string,
      status: orderStatus,
      paymentStatus: paymentStatus,
      totalSnapshot: number,
      createdAt: string,
    }
  ],
  pagination: { page, limit, total, totalPages }
}

// GET /api/orders/:id
{
  data: {
    id, orderNumber, customerId, customer,
    status, paymentStatus,
    shippingAddress, billingAddress,
    currency, subtotalSnapshot, taxRateSnapshot, taxAmountSnapshot,
    shippingAmountSnapshot, discountAmountSnapshot, totalSnapshot,
    promoCodeSnapshot, paymentMethod, customerNotes,
    items: [...],
    createdAt, updatedAt
  }
}
```

---

## Context

### Phase Dependencies
- **Phase 3 Complete:** Checkout creates orders
- **Phase 4 Complete:** Customers receive order confirmation emails
- **Blocks Phase 6:** Address management needs orders context

### Discovery Findings

**Existing Order List Page (orders/page.tsx:10-25):**
```typescript
const orders = [
  { id: 'ORD-001', date: '2023-12-01', status: 'Delivered', total: 129.99, items: 3 },
  { id: 'ORD-002', date: '2023-11-15', status: 'Processing', total: 59.99, items: 1 },
];
```
Mock data needs to be replaced with API call.

**Existing Order Detail Page (orders/[id]/page.tsx:13-43):**
```typescript
const order = {
  id: 'ORD-001', date: '2023-12-01', status: 'Delivered',
  total: 129.99, subtotal: 119.99, shipping: 10.00,
  shippingAddress: { ... },
  items: [ ... ]
};
```
Mock data needs to be replaced with API call.

**Payment Method Display Issue (line 123):**
```typescript
<p>Visa ending in 4242</p>
```
Should display COD since we don't collect cards. Needs to show actual payment method from order.

**API Endpoints Available:**
- Line 431-472: `GET /api/orders` with pagination
- Line 478-587: `GET /api/orders/:id` with full details

**No Existing Hooks:**
- No `use-orders.ts` file exists
- Need to create React Query hooks following pattern from `use-cart.ts` and `use-products.ts`

**UI Components Needed:**
- Order status badges with colors
- Loading skeletons
- Error states
- Empty state (no orders yet)

---

## Tasks

### Task 1: Create React Query Hooks for Orders
**Goal:** Create reusable hooks for fetching orders data

**Create `apps/lab404-website/src/hooks/use-orders.ts`:**
```typescript
import { useQuery, UseQueryResult } from '@tanstack/react-query';
import { api } from '@/lib/api';

// Types
interface OrderListItem {
  id: string;
  orderNumber: string;
  status: 'pending' | 'confirmed' | 'processing' | 'shipped' | 'delivered' | 'cancelled';
  paymentStatus: 'pending' | 'paid' | 'refunded' | 'failed';
  totalSnapshot: number;
  createdAt: string;
}

interface OrderDetail {
  id: string;
  orderNumber: string;
  customerId: string | null;
  customer: {
    id: string;
    email: string;
    firstName: string;
    lastName: string;
  } | null;
  status: string;
  paymentStatus: string;
  shippingAddress: {
    firstName: string;
    lastName: string;
    company?: string;
    addressLine1: string;
    addressLine2?: string;
    city: string;
    state?: string;
    postalCode?: string;
    country: string;
    phone?: string;
    email?: string;
  };
  billingAddress: any;
  currency: string;
  subtotalSnapshot: number;
  taxRateSnapshot: number;
  taxAmountSnapshot: number;
  shippingAmountSnapshot: number;
  discountAmountSnapshot: number;
  totalSnapshot: number;
  promoCodeSnapshot: string | null;
  paymentMethod: string;
  customerNotes: string | null;
  trackingNumber: string | null;
  items: Array<{
    id: string;
    productNameSnapshot: string;
    skuSnapshot: string;
    quantity: number;
    unitPriceSnapshot: number;
    variantOptionsSnapshot: Record<string, string> | null;
  }>;
  createdAt: string;
  updatedAt: string;
}

interface PaginationMeta {
  page: number;
  limit: number;
  total: number;
  totalPages: number;
}

interface OrdersResponse {
  data: OrderListItem[];
  pagination: PaginationMeta;
}

interface OrderResponse {
  data: OrderDetail;
}

/**
 * Fetch paginated list of customer orders
 */
export function useOrders(page: number = 1, limit: number = 10): UseQueryResult<OrdersResponse> {
  return useQuery({
    queryKey: ['orders', page, limit],
    queryFn: async () => {
      const response = await api.get<OrdersResponse>(`/orders?page=${page}&limit=${limit}`);
      return response.data;
    },
  });
}

/**
 * Fetch single order by ID
 */
export function useOrder(orderId: string | undefined): UseQueryResult<OrderDetail> {
  return useQuery({
    queryKey: ['order', orderId],
    queryFn: async () => {
      if (!orderId) throw new Error('Order ID required');
      const response = await api.get<OrderResponse>(`/orders/${orderId}`);
      return response.data.data;
    },
    enabled: !!orderId,
  });
}

/**
 * Fetch order by order number (for tracking)
 */
export function useOrderByNumber(orderNumber: string | undefined): UseQueryResult<OrderDetail> {
  return useQuery({
    queryKey: ['order', 'number', orderNumber],
    queryFn: async () => {
      if (!orderNumber) throw new Error('Order number required');
      const response = await api.get<OrderResponse>(`/orders/track/${orderNumber}`);
      return response.data.data;
    },
    enabled: !!orderNumber,
  });
}
```

**Pattern Notes:**
- Follows existing hooks pattern (use-cart.ts, use-products.ts)
- Uses React Query for caching and automatic refetching
- Types match API response structure
- `enabled` flag prevents queries when no ID provided
- Query keys allow for cache invalidation

**Validation:**
- TypeScript compiles without errors
- Hooks export correctly
- Query keys unique and descriptive

**Files:**
- `apps/lab404-website/src/hooks/use-orders.ts` (NEW FILE)

---

### Task 2: Create Order Status Badge Component
**Goal:** Reusable component for displaying order status with proper colors

**Create `apps/lab404-website/src/components/orders/order-status-badge.tsx`:**
```typescript
import { Badge } from '@/components/ui/badge';
import { cn } from '@/lib/utils';

type OrderStatus = 'pending' | 'confirmed' | 'processing' | 'shipped' | 'delivered' | 'cancelled';

interface OrderStatusBadgeProps {
  status: OrderStatus;
  className?: string;
}

/**
 * Display order status with appropriate color
 * - pending: yellow (waiting for confirmation)
 * - confirmed: blue (order confirmed, preparing)
 * - processing: blue (being prepared)
 * - shipped: purple (in transit)
 * - delivered: green (successfully delivered)
 * - cancelled: red (cancelled)
 */
export function OrderStatusBadge({ status, className }: OrderStatusBadgeProps) {
  const variants = {
    pending: 'bg-yellow-100 text-yellow-800 hover:bg-yellow-100',
    confirmed: 'bg-blue-100 text-blue-800 hover:bg-blue-100',
    processing: 'bg-blue-100 text-blue-800 hover:bg-blue-100',
    shipped: 'bg-purple-100 text-purple-800 hover:bg-purple-100',
    delivered: 'bg-green-100 text-green-800 hover:bg-green-100',
    cancelled: 'bg-red-100 text-red-800 hover:bg-red-100',
  };

  const labels = {
    pending: 'Pending',
    confirmed: 'Confirmed',
    processing: 'Processing',
    shipped: 'Shipped',
    delivered: 'Delivered',
    cancelled: 'Cancelled',
  };

  return (
    <Badge
      variant="secondary"
      className={cn(variants[status], className)}
    >
      {labels[status]}
    </Badge>
  );
}
```

**Color Scheme:**
- Pending: Yellow (warning, awaiting action)
- Confirmed/Processing: Blue (in progress)
- Shipped: Purple (in transit)
- Delivered: Green (success)
- Cancelled: Red (error/cancelled)

**Validation:**
- Badge renders with correct colors
- Labels display properly
- className prop allows customization

**Files:**
- `apps/lab404-website/src/components/orders/order-status-badge.tsx` (NEW FILE)

---

### Task 3: Update Order List Page with Live Data
**Goal:** Replace mock data with API calls and add loading/error states

**Changes to `apps/lab404-website/src/app/account/orders/page.tsx`:**
```typescript
'use client';

import AccountLayout from '@/components/layout/account-layout';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { OrderStatusBadge } from '@/components/orders/order-status-badge';
import { useOrders } from '@/hooks/use-orders';
import Link from 'next/link';
import { Loader2, Package } from 'lucide-react';
import { format } from 'date-fns';

export default function OrdersPage() {
    const { data, isLoading, error } = useOrders();

    // Loading state
    if (isLoading) {
        return (
            <AccountLayout>
                <div className="space-y-6">
                    <div>
                        <h1 className="text-3xl font-bold tracking-tight">Orders</h1>
                        <p className="text-muted-foreground">
                            View your order history and status.
                        </p>
                    </div>
                    <div className="flex items-center justify-center py-12">
                        <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />
                    </div>
                </div>
            </AccountLayout>
        );
    }

    // Error state
    if (error) {
        return (
            <AccountLayout>
                <div className="space-y-6">
                    <div>
                        <h1 className="text-3xl font-bold tracking-tight">Orders</h1>
                        <p className="text-muted-foreground">
                            View your order history and status.
                        </p>
                    </div>
                    <Card>
                        <CardContent className="p-8 text-center">
                            <p className="text-destructive">Failed to load orders. Please try again.</p>
                        </CardContent>
                    </Card>
                </div>
            </AccountLayout>
        );
    }

    const orders = data?.data || [];

    // Empty state
    if (orders.length === 0) {
        return (
            <AccountLayout>
                <div className="space-y-6">
                    <div>
                        <h1 className="text-3xl font-bold tracking-tight">Orders</h1>
                        <p className="text-muted-foreground">
                            View your order history and status.
                        </p>
                    </div>
                    <Card>
                        <CardContent className="flex flex-col items-center justify-center py-12">
                            <Package className="h-12 w-12 text-muted-foreground mb-4" />
                            <h3 className="text-lg font-semibold mb-2">No orders yet</h3>
                            <p className="text-muted-foreground text-center mb-4">
                                When you place orders, they'll appear here.
                            </p>
                            <Link href="/products">
                                <Button>Continue Shopping</Button>
                            </Link>
                        </CardContent>
                    </Card>
                </div>
            </AccountLayout>
        );
    }

    return (
        <AccountLayout>
            <div className="space-y-6">
                <div>
                    <h1 className="text-3xl font-bold tracking-tight">Orders</h1>
                    <p className="text-muted-foreground">
                        View your order history and status.
                    </p>
                </div>

                <div className="space-y-4">
                    {orders.map((order) => (
                        <Card key={order.id}>
                            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                                <CardTitle className="text-base font-medium">
                                    Order #{order.orderNumber}
                                </CardTitle>
                                <OrderStatusBadge status={order.status} />
                            </CardHeader>
                            <CardContent>
                                <div className="flex items-center justify-between text-sm">
                                    <div className="text-muted-foreground">
                                        <p>Placed on {format(new Date(order.createdAt), 'MMM dd, yyyy')}</p>
                                    </div>
                                    <div className="flex items-center gap-4">
                                        <span className="font-medium">${order.totalSnapshot.toFixed(2)}</span>
                                        <Link href={`/account/orders/${order.id}`}>
                                            <Button variant="outline" size="sm">View Details</Button>
                                        </Link>
                                    </div>
                                </div>
                            </CardContent>
                        </Card>
                    ))}
                </div>

                {/* Pagination (if needed based on data.pagination) */}
                {data?.pagination && data.pagination.totalPages > 1 && (
                    <div className="flex justify-center gap-2 mt-6">
                        <p className="text-sm text-muted-foreground">
                            Page {data.pagination.page} of {data.pagination.totalPages}
                        </p>
                    </div>
                )}
            </div>
        </AccountLayout>
    );
}
```

**Key Changes:**
- Replace mock data with `useOrders()` hook
- Add loading state with spinner
- Add error state with retry message
- Add empty state with "Continue Shopping" CTA
- Use `OrderStatusBadge` component
- Format dates with `date-fns`
- Remove "items" count (not in API response)
- Display `orderNumber` instead of `id`
- Use `totalSnapshot` for pricing

**Validation:**
- Page loads and displays real orders
- Loading spinner shows while fetching
- Error message displays on API failure
- Empty state shows when no orders
- Status badges display correctly
- Dates format properly
- Links work to detail page

**Files:**
- `apps/lab404-website/src/app/account/orders/page.tsx`

---

### Task 4: Update Order Detail Page with Live Data
**Goal:** Replace mock data with API call and display complete order information

**Changes to `apps/lab404-website/src/app/account/orders/[id]/page.tsx`:**
```typescript
'use client';

import AccountLayout from '@/components/layout/account-layout';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Separator } from '@/components/ui/separator';
import { OrderStatusBadge } from '@/components/orders/order-status-badge';
import { useOrder } from '@/hooks/use-orders';
import { ArrowLeft, Loader2, Truck } from 'lucide-react';
import Link from 'next/link';
import { useParams } from 'next/navigation';
import { format } from 'date-fns';

export default function OrderDetailPage() {
    const params = useParams();
    const id = params.id as string;
    const { data: order, isLoading, error } = useOrder(id);

    // Loading state
    if (isLoading) {
        return (
            <AccountLayout>
                <div className="flex items-center justify-center py-12">
                    <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />
                </div>
            </AccountLayout>
        );
    }

    // Error state
    if (error || !order) {
        return (
            <AccountLayout>
                <div className="space-y-6">
                    <div className="flex items-center gap-4">
                        <Link href="/account/orders">
                            <Button variant="ghost" size="icon">
                                <ArrowLeft className="h-4 w-4" />
                            </Button>
                        </Link>
                        <h1 className="text-2xl font-bold tracking-tight">Order Not Found</h1>
                    </div>
                    <Card>
                        <CardContent className="p-8 text-center">
                            <p className="text-destructive">Failed to load order details. Please try again.</p>
                            <Link href="/account/orders">
                                <Button className="mt-4">Back to Orders</Button>
                            </Link>
                        </CardContent>
                    </Card>
                </div>
            </AccountLayout>
        );
    }

    return (
        <AccountLayout>
            <div className="space-y-6">
                <div className="flex items-center gap-4">
                    <Link href="/account/orders">
                        <Button variant="ghost" size="icon">
                            <ArrowLeft className="h-4 w-4" />
                        </Button>
                    </Link>
                    <div>
                        <h1 className="text-2xl font-bold tracking-tight">Order #{order.orderNumber}</h1>
                        <p className="text-muted-foreground">
                            Placed on {format(new Date(order.createdAt), 'MMMM dd, yyyy')}
                        </p>
                    </div>
                    <OrderStatusBadge status={order.status} className="ml-auto" />
                </div>

                {/* Tracking Number */}
                {order.trackingNumber && (
                    <Card className="border-blue-200 bg-blue-50">
                        <CardContent className="flex items-center gap-3 p-4">
                            <Truck className="h-5 w-5 text-blue-600" />
                            <div>
                                <p className="text-sm font-medium text-blue-900">Tracking Number</p>
                                <p className="text-sm text-blue-700">{order.trackingNumber}</p>
                            </div>
                        </CardContent>
                    </Card>
                )}

                <div className="grid gap-6 md:grid-cols-2">
                    {/* Order Items */}
                    <Card className="md:col-span-2">
                        <CardHeader>
                            <CardTitle>Order Items</CardTitle>
                        </CardHeader>
                        <CardContent>
                            <div className="space-y-4">
                                {order.items.map((item) => (
                                    <div key={item.id} className="flex justify-between text-sm">
                                        <div>
                                            <p className="font-medium">{item.productNameSnapshot}</p>
                                            {item.variantOptionsSnapshot && (
                                                <p className="text-xs text-muted-foreground">
                                                    {Object.entries(item.variantOptionsSnapshot)
                                                        .map(([key, value]) => `${key}: ${value}`)
                                                        .join(', ')}
                                                </p>
                                            )}
                                            <p className="text-xs text-muted-foreground">SKU: {item.skuSnapshot}</p>
                                            <p className="text-muted-foreground">Qty: {item.quantity}</p>
                                        </div>
                                        <span className="font-medium">
                                            ${(item.unitPriceSnapshot * item.quantity).toFixed(2)}
                                        </span>
                                    </div>
                                ))}
                                <Separator className="my-4" />
                                <div className="space-y-1.5">
                                    <div className="flex justify-between text-sm">
                                        <span className="text-muted-foreground">Subtotal</span>
                                        <span>${order.subtotalSnapshot.toFixed(2)}</span>
                                    </div>
                                    {order.discountAmountSnapshot > 0 && (
                                        <div className="flex justify-between text-sm">
                                            <span className="text-muted-foreground">
                                                Discount {order.promoCodeSnapshot && `(${order.promoCodeSnapshot})`}
                                            </span>
                                            <span className="text-green-600">-${order.discountAmountSnapshot.toFixed(2)}</span>
                                        </div>
                                    )}
                                    {order.taxAmountSnapshot > 0 && (
                                        <div className="flex justify-between text-sm">
                                            <span className="text-muted-foreground">
                                                Tax ({(order.taxRateSnapshot * 100).toFixed(0)}%)
                                            </span>
                                            <span>${order.taxAmountSnapshot.toFixed(2)}</span>
                                        </div>
                                    )}
                                    <div className="flex justify-between text-sm">
                                        <span className="text-muted-foreground">Shipping</span>
                                        <span>
                                            {order.shippingAmountSnapshot === 0
                                                ? 'Free'
                                                : `$${order.shippingAmountSnapshot.toFixed(2)}`}
                                        </span>
                                    </div>
                                    <div className="flex justify-between text-base font-medium pt-2 border-t">
                                        <span>Total</span>
                                        <span>${order.totalSnapshot.toFixed(2)}</span>
                                    </div>
                                </div>
                            </div>
                        </CardContent>
                    </Card>

                    {/* Shipping Address */}
                    <Card>
                        <CardHeader>
                            <CardTitle>Shipping Address</CardTitle>
                        </CardHeader>
                        <CardContent className="text-sm">
                            <p>{order.shippingAddress.firstName} {order.shippingAddress.lastName}</p>
                            {order.shippingAddress.company && <p>{order.shippingAddress.company}</p>}
                            <p>{order.shippingAddress.addressLine1}</p>
                            {order.shippingAddress.addressLine2 && <p>{order.shippingAddress.addressLine2}</p>}
                            <p>
                                {order.shippingAddress.city}
                                {order.shippingAddress.state && `, ${order.shippingAddress.state}`}
                                {order.shippingAddress.postalCode && ` ${order.shippingAddress.postalCode}`}
                            </p>
                            <p>{order.shippingAddress.country}</p>
                            {order.shippingAddress.phone && <p className="mt-2">Phone: {order.shippingAddress.phone}</p>}
                        </CardContent>
                    </Card>

                    {/* Payment Method */}
                    <Card>
                        <CardHeader>
                            <CardTitle>Payment Method</CardTitle>
                        </CardHeader>
                        <CardContent className="text-sm">
                            <p className="capitalize">{order.paymentMethod.replace('_', ' ')}</p>
                            {order.paymentMethod === 'cod' && (
                                <p className="text-xs text-muted-foreground mt-1">
                                    Pay with cash when you receive your order
                                </p>
                            )}
                        </CardContent>
                    </Card>
                </div>

                {/* Customer Notes */}
                {order.customerNotes && (
                    <Card>
                        <CardHeader>
                            <CardTitle>Order Notes</CardTitle>
                        </CardHeader>
                        <CardContent className="text-sm">
                            <p className="text-muted-foreground">{order.customerNotes}</p>
                        </CardContent>
                    </Card>
                )}
            </div>
        </AccountLayout>
    );
}
```

**Key Changes:**
- Replace mock data with `useOrder(id)` hook
- Add loading and error states
- Display real order data from API
- Show tracking number if available
- Display variant options if present
- Show discount with promo code
- Show tax breakdown (from Phase 2)
- Display COD payment method correctly (not "Visa ending in 4242")
- Format addresses properly (handle optional fields)
- Show customer notes if provided
- Use proper date formatting

**Validation:**
- Order details load correctly
- All order information displays accurately
- Variant options show if product has variants
- Tax and discount calculations correct
- COD payment method displays correctly
- Tracking number shows if available
- Customer notes display if present

**Files:**
- `apps/lab404-website/src/app/account/orders/[id]/page.tsx`

---

### Task 5: Add date-fns Dependency
**Goal:** Install date-fns for date formatting

**Install dependency:**
```bash
cd apps/lab404-website
pnpm add date-fns
```

**Usage:**
```typescript
import { format } from 'date-fns';

// Format date
format(new Date(order.createdAt), 'MMM dd, yyyy') // "Jan 08, 2026"
format(new Date(order.createdAt), 'MMMM dd, yyyy') // "January 08, 2026"
```

**Validation:**
- Package installs successfully
- Dates format correctly in order pages
- No TypeScript errors

**Files:**
- `apps/lab404-website/package.json` (dependency added)

---

### Task 6: Test Order History Flow
**Goal:** Manual testing to verify complete flow works

**Test Scenarios:**

**1. Order List Page:**
- Navigate to `/account/orders`
- Verify loading spinner shows
- Verify orders display with correct data
- Verify status badges show correct colors
- Verify dates format correctly
- Verify totals display correctly
- Click "View Details" button

**2. Order Detail Page:**
- Verify order details load
- Verify all order items display with correct quantities and prices
- Verify subtotal, tax, shipping, discount, and total match
- Verify shipping address displays correctly
- Verify payment method shows "COD"
- Verify customer notes display if present
- Verify "Back" button works

**3. Empty State:**
- Test with account that has no orders
- Verify empty state displays
- Verify "Continue Shopping" button works

**4. Error Scenarios:**
- Test with invalid order ID
- Verify error message displays
- Test with network failure (API down)
- Verify error handling

**5. Authentication:**
- Test accessing orders without login
- Verify redirect to login page
- Test accessing another customer's order
- Verify 403 Forbidden error

**Testing Checklist:**
- [ ] Order list loads and displays real orders
- [ ] Order status badges show correct colors
- [ ] Dates format correctly (date-fns)
- [ ] Order totals display accurately
- [ ] "View Details" links work
- [ ] Order detail page loads with all information
- [ ] Order items display with correct data
- [ ] Pricing breakdown accurate (subtotal, tax, shipping, discount, total)
- [ ] Shipping address displays correctly
- [ ] COD payment method displays correctly (not "Visa")
- [ ] Customer notes display if present
- [ ] Tracking number displays if present
- [ ] Empty state works (no orders)
- [ ] Loading states work
- [ ] Error states work
- [ ] Back button works
- [ ] Authentication required (redirect to login if not logged in)
- [ ] Cannot access other customer's orders

**Files:**
- No files modified (testing only)

---

## Verification Checklist

**Before marking complete:**
- [ ] React Query hooks created (useOrders, useOrder)
- [ ] OrderStatusBadge component created with correct colors
- [ ] Order list page connects to API
- [ ] Order detail page connects to API
- [ ] Loading states implemented
- [ ] Error states implemented
- [ ] Empty state implemented (no orders)
- [ ] date-fns dependency installed
- [ ] Dates format correctly
- [ ] Order status badges display correctly
- [ ] COD payment method displays correctly (not card info)
- [ ] Pricing breakdown accurate
- [ ] Shipping address displays correctly
- [ ] Customer notes display if present
- [ ] Tracking number displays if present
- [ ] Variant options display for products with variants

---

## Success Criteria

**Must Have:**
1. ✅ Order list displays real customer orders from API
2. ✅ Order details display complete order information
3. ✅ Order status badges show correct colors
4. ✅ Loading and error states implemented
5. ✅ Empty state for customers with no orders
6. ✅ COD payment method displays correctly

**User Experience:**
- Fast loading with React Query caching
- Clear visual feedback (loading spinners, status badges)
- Graceful error handling
- Easy navigation (back button, links)
- Complete order information accessible

**Technical Quality:**
- Reusable React Query hooks
- Type-safe TypeScript interfaces
- Follows existing patterns (use-cart.ts, use-products.ts)
- Proper error handling
- Clean component structure

---

## Output

**New Files:**
- `apps/lab404-website/src/hooks/use-orders.ts` - React Query hooks for orders
- `apps/lab404-website/src/components/orders/order-status-badge.tsx` - Status badge component

**Modified Files:**
- `apps/lab404-website/src/app/account/orders/page.tsx` - Connect to API
- `apps/lab404-website/src/app/account/orders/[id]/page.tsx` - Connect to API
- `apps/lab404-website/package.json` - Add date-fns dependency

**Testing:**
- Manual testing of complete order history flow
- Verify all states (loading, error, empty, success)
- Verify data accuracy

**Commits:**
- Commit 1: Create React Query hooks for orders
- Commit 2: Create order status badge component
- Commit 3: Update order list page with live data
- Commit 4: Update order detail page with live data
- Commit 5: Add date-fns dependency
- Commit 6: Test order history flow (documentation)
- Commit 7: Create SUMMARY.md

---

## Risk Assessment

**Low Risk:**
- API endpoints already exist and tested
- UI structure already exists
- React Query hooks follow existing patterns
- No database changes needed

**Mitigation:**
- Comprehensive error handling
- Loading states prevent confusion
- Empty states guide user to shopping
- Authentication checks prevent unauthorized access

---

## Notes

**Why 6 Tasks:**
- Task 1: Create React Query hooks (data fetching)
- Task 2: Create status badge component (reusable UI)
- Task 3: Update order list page (main feature)
- Task 4: Update order detail page (main feature)
- Task 5: Add date-fns dependency (formatting)
- Task 6: Testing (validation)

**Out of Scope (Future Phases):**
- Order search and filtering (low priority)
- Pagination UI (can add if needed)
- Order cancellation (requires admin approval workflow)
- Order tracking page (Phase 6 or later)
- Mobile optimization (Phase 10)

**API Endpoints Used:**
- `GET /api/orders` - List orders (line 431-472)
- `GET /api/orders/:id` - Order details (line 478-587)

**Order Status Flow:**
1. `pending` - Order created, awaiting confirmation
2. `confirmed` - Order confirmed, preparing
3. `processing` - Order being prepared
4. `shipped` - Order shipped, in transit
5. `delivered` - Order delivered to customer
6. `cancelled` - Order cancelled

**Dependencies:**
✅ Phase 3: Orders being created via checkout
✅ Phase 4: Email confirmations sent
→ Phase 6: Address management will use order context

---

*Plan created: 2026-01-08*
*Ready for execution: Yes*
*Estimated time: 2-3 hours*
